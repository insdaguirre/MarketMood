# âš¡ 90-Minute Setup Guide

## Where to Put API Keys

**Create `.env` files in these locations:**

1. **`backend/.env`** - All backend API keys and secrets
2. **`frontend/.env`** - Frontend API base URL

### Quick Setup

```bash
# Run the setup script (creates .env files and generates secrets)
./setup.sh

# Or manually:
cp backend/.env.example backend/.env
cp frontend/.env.example frontend/.env
```

### Required API Keys for `backend/.env`:

```env
# External APIs (get these first - 15 min)
FINNHUB_API_KEY=your_key_here          # https://finnhub.io/register
REDDIT_CLIENT_ID=your_id               # https://www.reddit.com/prefs/apps
REDDIT_CLIENT_SECRET=your_secret       # From Reddit app
NEWSAPI_KEY=your_key                   # https://newsapi.org/register
OPENAI_API_KEY=your_key                # https://platform.openai.com/api-keys

# Databases (set up next - 10 min)
POSTGRES_URL=postgresql://...          # From Neon or Railway
REDIS_URL=rediss://...                 # From Upstash

# Secrets (auto-generated by setup.sh)
JWT_SECRET=...                         # 32+ chars (auto-generated)
ADMIN_KEY=...                          # For cron jobs (auto-generated)

# Ticker tiers (already set in .env.example)
TICKER_TIERS_JSON={"T0":[...],...}
```

## Deployment Steps (90 minutes total)

### Step 1: Get API Keys (15 min)
- âœ… Finnhub: https://finnhub.io/register
- âœ… NewsAPI: https://newsapi.org/register  
- âœ… Reddit: https://www.reddit.com/prefs/apps (create "script" app)
- âœ… OpenAI: https://platform.openai.com/api-keys

### Step 2: Set Up Databases (10 min)

**Neon Postgres:**
1. Go to https://neon.tech â†’ Sign up
2. Create project â†’ Copy connection string
3. In SQL Editor, run: `CREATE EXTENSION IF NOT EXISTS vector;`
4. Add to `backend/.env` as `POSTGRES_URL`

**Upstash Redis:**
1. Go to https://upstash.com â†’ Sign up
2. Create database â†’ Copy REST URL
3. Add to `backend/.env` as `REDIS_URL`

### Step 3: Deploy Backend to Railway (30 min)

1. **Connect Repository:**
   - Go to https://railway.app
   - New Project â†’ Deploy from GitHub
   - Select your MarketMood repo

2. **Configure Service:**
   - Settings â†’ Root Directory: `backend`
   - Variables tab â†’ Add ALL variables from `backend/.env`
     - Copy each `KEY=value` line
     - Add as separate Railway variables

3. **Add Postgres:**
   - + New â†’ Database â†’ PostgreSQL
   - Railway auto-creates `POSTGRES_URL`
   - Update your `.env` to use Railway's URL

4. **Deploy & Migrate:**
   ```bash
   # Install Railway CLI (optional)
   npm i -g @railway/cli
   
   # Run migrations
   railway run npm run db:migrate
   ```

5. **Get Your Backend URL:**
   - Railway dashboard â†’ Your service â†’ Settings
   - Copy the public domain (e.g., `https://your-app.up.railway.app`)

### Step 4: Set Up Cron Jobs (10 min)

In Railway, create these cron jobs:

**T0 Ingestion (every 10 min):**
- Schedule: `*/10 * * * *`
- Command: 
```bash
curl -X POST -H "X-ADMIN-KEY: $ADMIN_KEY" https://your-app.up.railway.app/admin/ingest?tier=T0
```

**T1 Ingestion (every 30 min):**
- Schedule: `*/30 * * * *`
- Command:
```bash
curl -X POST -H "X-ADMIN-KEY: $ADMIN_KEY" https://your-app.up.railway.app/admin/ingest?tier=T1
```

**Retention (hourly):**
- Schedule: `0 * * * *`
- Command:
```bash
curl -X POST -H "X-ADMIN-KEY: $ADMIN_KEY" https://your-app.up.railway.app/admin/retention
```

**Replace `your-app.up.railway.app` with your actual Railway domain!**

### Step 5: Deploy Frontend (15 min)

**Option A: Railway (Easiest)**
1. In Railway project â†’ + New â†’ Service
2. Connect GitHub repo
3. Settings:
   - Root Directory: `frontend`
   - Build Command: `npm run build`
   - Output Directory: `dist`
4. Variables:
   - `VITE_API_BASE_URL` = Your backend Railway URL

**Option B: Cloudflare Pages**
1. Build locally: `cd frontend && npm install && npm run build`
2. Cloudflare Dashboard â†’ Pages â†’ Upload `frontend/dist`
3. Add env var: `VITE_API_BASE_URL` = Backend URL

### Step 6: Test (10 min)

```bash
# Health check
curl https://your-app.up.railway.app/healthz

# Test sentiment (after ingestion runs)
curl "https://your-app.up.railway.app/api/sentiment?ticker=AAPL"

# Manual ingestion trigger
curl -X POST -H "X-ADMIN-KEY: your_admin_key" \
  https://your-app.up.railway.app/admin/ingest?tier=T0
```

## Quick Troubleshooting

**Backend won't start:**
- Check Railway logs
- Verify all env vars are set in Railway Variables
- Ensure `POSTGRES_URL` format is correct

**Database errors:**
- Run migrations: `railway run npm run db:migrate`
- Verify pgvector: `CREATE EXTENSION vector;` in Neon SQL Editor

**Frontend can't connect:**
- Check `VITE_API_BASE_URL` matches Railway backend URL exactly
- Verify backend is running (check `/healthz`)

**Cron jobs not working:**
- Check Railway cron logs
- Verify `ADMIN_KEY` is set in Railway variables
- Ensure Railway domain is correct in cron commands

## Time-Saving Shortcuts

If running low on time:
1. âœ… Skip Stocktwits (optional)
2. âœ… Use Railway Postgres instead of Neon (faster)
3. âœ… Deploy frontend later, test backend first
4. âœ… Mock sentiment/embeddings work if ONNX models missing

## Cost

All free tiers:
- Railway: 500 hours/month free
- Neon: 0.5GB free
- Upstash: 10K commands/day free
- Cloudflare Pages: Free
- **Total: $0/month**

## Files Created

- âœ… `backend/.env` - Your API keys go here
- âœ… `frontend/.env` - Frontend config
- âœ… `DEPLOYMENT.md` - Detailed deployment guide
- âœ… `QUICK_START.md` - Step-by-step checklist
- âœ… `setup.sh` - Auto-setup script

## Next Steps After Deployment

1. Monitor Railway usage (stay under free tier)
2. Set up spend alerts in Railway
3. Test ingestion: `curl -X POST .../admin/ingest?tier=T0`
4. Check logs for errors
5. Visit frontend URL and test features

Good luck! ðŸš€
